-- Aula 4

-- Exercício 1: Primeira Forma Normal (1FN)

-- Tabela de Alunos
CREATE TABLE ALUNOS (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOME VARCHAR2(100),
    CONSTRAINT PK_ALUNOS PRIMARY KEY (ID)
);

-- Tabela de Hobbies
CREATE TABLE HOBBIES (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    DESCRICAO VARCHAR2(100),
    CONSTRAINT PK_HOBBIES PRIMARY KEY (ID),
    CONSTRAINT UK_HOBBIES_DESCRICAO UNIQUE (DESCRICAO)
);

-- Tabela de relacionamento (N:N)
CREATE TABLE ALUNO_HOBBY (
    ALUNO_ID NUMBER NOT NULL,
    HOBBY_ID NUMBER NOT NULL,
    CONSTRAINT PK_ALUNO_HOBBY PRIMARY KEY (ALUNO_ID, HOBBY_ID),
    CONSTRAINT FK_ALUNO_HOBBY_ALUNO FOREIGN KEY (ALUNO_ID) REFERENCES ALUNOS(ID),
    CONSTRAINT FK_ALUNO_HOBBY_HOBBY FOREIGN KEY (HOBBY_ID) REFERENCES HOBBIES(ID)
);

-- Exercício 2: Segunda Forma Normal (2FN)

-- Pedidos
CREATE TABLE PEDIDOS (
    ID NUMBER,
    NOME_CLIENTE VARCHAR2(100),
    CONSTRAINT PK_PEDIDOS PRIMARY KEY (ID)
);

-- Produtos
CREATE TABLE PRODUTOS (
    ID NUMBER,
    NOME_PRODUTO VARCHAR2(100),
    CONSTRAINT PK_PRODUTOS PRIMARY KEY (ID)
);

-- Itens do Pedido (N:N)
CREATE TABLE PEDIDO_ITEM (
    PEDIDO_ID NUMBER NOT NULL,
    PRODUTO_ID NUMBER NOT NULL,
    QUANTIDADE NUMBER CHECK (QUANTIDADE > 0),
    CONSTRAINT PK_PEDIDO_ITEM PRIMARY KEY (PEDIDO_ID, PRODUTO_ID),
    CONSTRAINT FK_PEDIDO_ITEM_PEDIDO FOREIGN KEY (PEDIDO_ID) REFERENCES PEDIDOS(ID),
    CONSTRAINT FK_PEDIDO_ITEM_PRODUTO FOREIGN KEY (PRODUTO_ID) REFERENCES PRODUTOS(ID)
);


-- Exercício 3: Terceira Forma Normal (3FN)

-- Gerentes de Departamento
CREATE TABLE GERENTES_DEPARTAMENTO (
    ID NUMBER,
    NOME VARCHAR2(100),
    CONSTRAINT PK_GERENTES PRIMARY KEY (ID)
);

-- Departamentos (cada departamento pode ter um gerente)
CREATE TABLE DEPARTAMENTOS (
    ID NUMBER,
    NOME VARCHAR2(100),
    GERENTE_ID NUMBER,
    CONSTRAINT PK_DEPARTAMENTOS PRIMARY KEY (ID),
    CONSTRAINT FK_DEPARTAMENTOS_GERENTE FOREIGN KEY (GERENTE_ID) REFERENCES GERENTES_DEPARTAMENTO(ID)
);

-- Funcionários (cada funcionário pertence a um depto)
CREATE TABLE FUNCIONARIOS (
    ID NUMBER,
    NOME VARCHAR2(100),
    DEPARTAMENTO_ID NUMBER NOT NULL,
    CONSTRAINT PK_FUNCIONARIOS PRIMARY KEY (ID),
    CONSTRAINT FK_FUNCIONARIOS_DEPARTAMENTO FOREIGN KEY (DEPARTAMENTO_ID) REFERENCES DEPARTAMENTOS(ID)
);


-- Exercício 4: Forma Normal de Boyce-Codd (BCNF)

-- Professores
CREATE TABLE PROFESSORES (
    ID NUMBER,
    NOME VARCHAR2(100),
    SALA VARCHAR2(10),
    CONSTRAINT PK_PROFESSORES PRIMARY KEY (ID)
);

-- Disciplinas
CREATE TABLE DISCIPLINAS (
    ID NUMBER,
    NOME VARCHAR2(100),
    SALA VARCHAR2(10),
    CONSTRAINT PK_DISCIPLINAS PRIMARY KEY (ID)
);

-- Relacionamento Professor - Disciplina
CREATE TABLE PROFESSOR_DISCIPLINA (
    PROFESSOR_ID NUMBER NOT NULL,
    DISCIPLINA_ID NUMBER NOT NULL,
    CONSTRAINT PK_PROFESSOR_DISCIPLINA PRIMARY KEY (PROFESSOR_ID, DISCIPLINA_ID),
    CONSTRAINT FK_PROFESSOR_DISCIPLINA_PROF FOREIGN KEY (PROFESSOR_ID) REFERENCES PROFESSORES(ID),
    CONSTRAINT FK_PROFESSOR_DISCIPLINA_DISC FOREIGN KEY (DISCIPLINA_ID) REFERENCES DISCIPLINAS(ID)
);

-- Exercício 5: Impactos da Normalização e Quando Desnormalizar

-- Vendas Relatório (tabela desnormalizada, simplificada)
CREATE TABLE VENDAS_RELATORIO (
    ID NUMBER,
    CLIENTE_NOME VARCHAR2(100),
    PRODUTO_NOME VARCHAR2(100),
    VALOR_TOTAL NUMBER(10,2),
    DATA_VENDA DATE,
    CONSTRAINT PK_VENDAS_RELATORIO PRIMARY KEY (ID)
);

