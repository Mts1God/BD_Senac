CREATE TABLE CLIENTES (
    id_cliente NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    nome       VARCHAR2(100) NOT NULL,
    cidade     VARCHAR2(50),
    estado     VARCHAR2(2)
);

CREATE TABLE VENDAS (
    id          NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    produto     VARCHAR2(100) NOT NULL,
    categoria   VARCHAR2(50)  NOT NULL,
    valor       NUMBER(10,2)  NOT NULL CHECK (valor > 0),
    data_venda  DATE          DEFAULT SYSDATE,
    vendedor    VARCHAR2(100) NOT NULL,
    id_cliente  NUMBER,
    CONSTRAINT fk_cliente FOREIGN KEY (id_cliente) REFERENCES CLIENTES(id_cliente)
);

INSERT INTO CLIENTES (nome, cidade, estado) VALUES
  ('Ana', 'São Paulo', 'SP'),
  ('Bruna', 'Campinas', 'SP'),
  ('Carlos', 'Rio de Janeiro', 'RJ'),
  ('Daniel', 'Belo Horizonte', 'MG'); -- cliente sem vendas

INSERT INTO VENDAS (produto, categoria, valor, data_venda, vendedor, id_cliente) VALUES
  ('Notebook Dell', 'Eletrônicos', 4500.00, DATE '2025-04-01', 'Carlos', 3),
  ('Mouse Gamer', 'Acessórios', 150.00, DATE '2025-04-01', 'Ana', 1),
  ('Teclado Mecânico', 'Acessórios', 300.00, DATE '2025-04-02', 'Carlos', 3),
  ('Monitor 24"', 'Eletrônicos', 1200.00, DATE '2025-04-02', 'Bruna', 2),
  ('Fone Bluetooth', 'Acessórios', 200.00, DATE '2025-04-03', 'Ana', 1),
  ('Notebook HP', 'Eletrônicos', 4000.00, DATE '2025-04-03', 'Carlos', 3);

SELECT
    c.nome AS cliente,
    v.produto,
    v.valor
FROM CLIENTES c
INNER JOIN VENDAS v
    ON c.id_cliente = v.id_cliente;

SELECT
    c.nome AS cliente,
    v.produto,
    v.valor
FROM CLIENTES c
LEFT JOIN VENDAS v
    ON c.id_cliente = v.id_cliente;

SELECT
    c.nome AS cliente,
    c.cidade
FROM CLIENTES c
LEFT JOIN VENDAS v
    ON c.id_cliente = v.id_cliente
WHERE v.id IS NULL;

SELECT
    c.nome AS cliente,
    NVL(SUM(v.valor), 0) AS total_vendas
FROM CLIENTES c
LEFT JOIN VENDAS v
    ON c.id_cliente = v.id_cliente
GROUP BY c.nome
ORDER BY total_vendas DESC;

SELECT
    v.produto,
    c.nome AS cliente,
    c.cidade
FROM CLIENTES c
RIGHT JOIN VENDAS v
    ON c.id_cliente = v.id_cliente;

INSERT INTO VENDAS (produto, categoria, valor, data_venda, vendedor, id_cliente)
VALUES ('Cabo HDMI', 'Acessórios', 80.00, DATE '2025-04-04', 'Bruna', NULL);

SELECT
    v.produto,
    v.valor,
    c.nome AS cliente
FROM CLIENTES c
RIGHT JOIN VENDAS v
    ON c.id_cliente = v.id_cliente;

SELECT
    CASE WHEN c.nome IS NULL THEN 'Sem Cliente' ELSE c.nome END AS cliente,
    COUNT(v.id) AS qtd_vendas,
    SUM(v.valor) AS total
FROM CLIENTES c
RIGHT JOIN VENDAS v
    ON c.id_cliente = v.id_cliente
GROUP BY c.nome;

SELECT
    c.nome AS cliente,
    c.cidade,
    COUNT(v.id) AS qtd_vendas,
    NVL(SUM(v.valor), 0) AS total_vendas,
    ROUND(NVL(AVG(v.valor), 0), 2) AS ticket_medio
FROM CLIENTES c
LEFT JOIN VENDAS v
    ON c.id_cliente = v.id_cliente
GROUP BY c.nome, c.cidade
ORDER BY total_vendas DESC;

SELECT
    c.nome AS cliente,
    c.cidade,
    c.estado,
    v.produto,
    v.categoria,
    v.valor,
    v.data_venda,
    v.vendedor
FROM CLIENTES c
LEFT JOIN VENDAS v
    ON c.id_cliente = v.id_cliente
ORDER BY c.nome, v.data_venda;

SELECT
    v.produto,
    v.categoria,
    v.valor,
    v.data_venda,
    v.vendedor,
    NVL(c.nome, 'Sem Cliente') AS cliente,
    c.cidade,
    c.estado
FROM VENDAS v
LEFT JOIN CLIENTES c
    ON v.id_cliente = c.id_cliente
ORDER BY v.data_venda;


SELECT
    c.nome,
    c.cidade
FROM CLIENTES c
LEFT JOIN VENDAS v
    ON c.id_cliente = v.id_cliente
WHERE v.id IS NULL
ORDER BY c.nome;

SELECT
    c.cidade,
    NVL(SUM(v.valor), 0) AS total_vendas
FROM CLIENTES c
LEFT JOIN VENDAS v
    ON c.id_cliente = v.id_cliente
GROUP BY c.cidade
ORDER BY c.cidade;
