CREATE TABLE CLIENTES (
  id    NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  nome  VARCHAR2(100) NOT NULL,
  email VARCHAR2(120) UNIQUE
);

INSERT INTO CLIENTES (NOME, EMAIL) VALUES ('ROBERTA', 'ROBERTA@GMAIL.COM');
INSERT INTO CLIENTES (NOME, EMAIL) VALUES ('MARIANA', 'MARIANA@GMAIL.COM');
INSERT INTO CLIENTES (NOME, EMAIL) VALUES ('CLARA', 'CLARA@GMAIL.COM');
INSERT INTO CLIENTES (NOME, EMAIL) VALUES ('FELIPE', 'FELIPE@GMAIL.COM');
INSERT INTO CLIENTES (NOME, EMAIL) VALUES ('GABRIEL', 'GABRIEL@GMAIL.COM');
INSERT INTO CLIENTES (NOME, EMAIL) VALUES ('MATEUS', 'MATEUS@GMAIL.COM');

CREATE TABLE CLIENTES_STG (
  NOME  VARCHAR2(100) NOT NULL,
  EMAIL VARCHAR2(120) NOT NULL
);

INSERT ALL
  INTO CLIENTES_STG (nome, email) VALUES ('MATEUS Atualizado', 'MATEUS@GMAIL.COM') -- já existe
  INTO CLIENTES_STG (nome, email) VALUES ('Daniela Nova', 'daniela@techplus.com') -- novo
SELECT 1 FROM dual;

CREATE TABLE PRODUTOS (
  id     NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  nome   VARCHAR2(100) NOT NULL,
  preco  NUMBER(10,2)  NOT NULL CHECK (preco >= 0),
  tipo   VARCHAR2(50) NOT NULL
);

INSERT INTO PRODUTOS (NOME, PRECO, TIPO) VALUES ('ALFACE', 3, 'VERDURA');
INSERT INTO PRODUTOS (NOME, PRECO, TIPO) VALUES ('COENTRO', 4, 'VERDURA');
INSERT INTO PRODUTOS (NOME, PRECO, TIPO) VALUES ('PERA', 3, 'FRUTA');
INSERT INTO PRODUTOS (NOME, PRECO, TIPO) VALUES ('BANANA', 5, 'FRUTA');
INSERT INTO PRODUTOS (NOME, PRECO, TIPO) VALUES ('MAÇA', 3, 'FRUTA');
INSERT INTO PRODUTOS (NOME, PRECO, TIPO) VALUES ('CENOURA', 1, 'LEGUMES');

CREATE TABLE PEDIDOS (
  id         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  cliente_id NUMBER NOT NULL,
  produto_id NUMBER NOT NULL,
  status     VARCHAR2(20) NOT NULL CHECK (status IN ('ABERTO','FINALIZADO','CANCELADO'))
);

INSERT INTO PEDIDOS (cliente_id, produto_id, status)
VALUES 
  (1, 2, 'ABERTO'),
  (2, 3, 'CANCELADO'),
  (3, 4, 'FINALIZADO'),
  (4, 5, 'ABERTO'),
  (5, 6, 'FINALIZADO'),
  (6, 7, 'CANCELADO');
SELECT 1 FROM dual;

SELECT NOME, EMAIL FROM CLIENTES;
SELECT ID, NOME, PRECO, TIPO FROM PRODUTOS;
SELECT CLIENTE_ID, PRODUTO_ID, STATUS FROM PEDIDOS;

DELETE FROM PEDIDOS WHERE STATUS = 'CANCELADO';

MERGE INTO CLIENTES CL USING CLIENTES_STG STG
ON (CL.EMAIL = STG.EMAIL)
WHEN MATCHED THEN
    UPDATE SET CL.NOME = STG.NOME 
WHEN NOT MATCHED THEN
    INSERT (nome, email) VALUES ('Daniela Nova', 'daniela@techplus.com');


